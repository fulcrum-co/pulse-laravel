name: pulse

environments:
  production:
    php: 8.3
    node: 20

    build:
      - composer install --no-dev --optimize-autoloader
      - npm ci
      - npm run build

    deploy:
      - php artisan migrate --force
      - php artisan optimize:clear
      - php artisan config:clear
      - php artisan route:clear
      - php artisan view:clear
      - php artisan config:cache
      - php artisan route:cache
      - php artisan view:cache
      - composer dump-autoload --no-dev -o

    scheduler: true
    queue:
      workers: 1

    databases:
      - pulse-db

    caches:
      - pulse-cache

    environment:
      APP_ENV: production
      APP_DEBUG: false
      LOG_CHANNEL: stack
      CACHE_STORE: redis
      SESSION_DRIVER: redis
      QUEUE_CONNECTION: redis

  staging:
    php: 8.3
    node: 20

    build:
      - composer install --no-dev --optimize-autoloader
      - npm ci
      - npm run build

    deploy:
      - php artisan migrate --force
      - php artisan optimize:clear
      - php artisan config:clear
      - php artisan route:clear
      - php artisan view:clear
      - php artisan config:cache
      - php artisan route:cache
      - php artisan view:cache
      - composer dump-autoload --no-dev -o

    scheduler: true
    queue:
      workers: 1

    databases:
      - pulse-db-staging

    caches:
      - pulse-cache-staging

    environment:
      APP_ENV: staging
      APP_DEBUG: true
      LOG_CHANNEL: stack
      CACHE_STORE: redis
      SESSION_DRIVER: redis
      QUEUE_CONNECTION: redis
